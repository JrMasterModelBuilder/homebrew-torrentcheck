name: macOS 11

on: push

jobs:
  build:
    strategy:
      matrix:
        config:
          - host: macos-11
            name: torrentcheck
            test: 0

    runs-on: ${{ matrix.config.host }}

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Homebrew
        uses: Homebrew/actions/setup-homebrew@master

      - name: Tap Dir
        run: mkdir -p "$(dirname "$(brew --repo)/Library/Taps/${{ github.repository }}")"

      - name: Tap Link
        run: ln -s "$PWD" "$(brew --repo)/Library/Taps/${{ github.repository }}"

      - name: Info
        run: brew info "${{ github.repository }}/${{ matrix.config.name }}"

      - name: Install
        run: brew install -v "${{ github.repository }}/${{ matrix.config.name }}"

      - name: Installed
        run: brew info "${{ github.repository }}/${{ matrix.config.name }}"

      - name: Audit
        run: brew audit --except=file,specs "${{ github.repository }}/${{ matrix.config.name }}"

      - name: Test
        run: brew test "${{ github.repository }}/${{ matrix.config.name }}"
        if: matrix.config.test == 1
