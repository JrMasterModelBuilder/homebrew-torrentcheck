name: Ubuntu 22.04

on: push

jobs:
  build:
    strategy:
      matrix:
        config:
          - host: ubuntu-22.04
            name: torrentcheck
            test: 0

    runs-on: ${{ matrix.config.host }}

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Tap Dir
        run: mkdir -p "$(brew --repo)/Library/Taps/github"

      - name: Tap Link
        run: ln -s "$PWD" "$(brew --repo)/Library/Taps/github/homebrew-test"

      - name: Taps
        run: brew tap

      - name: Info
        run: brew info "github/test/${{ matrix.config.name }}"

      - name: Install
        run: brew install -v "github/test/${{ matrix.config.name }}"

      - name: Installed
        run: brew info "github/test/${{ matrix.config.name }}"

      - name: Audit
        run: brew audit --except=file,specs "github/test/${{ matrix.config.name }}"

      - name: Test
        run: brew test "github/test/${{ matrix.config.name }}"
        if: matrix.config.test == 1
